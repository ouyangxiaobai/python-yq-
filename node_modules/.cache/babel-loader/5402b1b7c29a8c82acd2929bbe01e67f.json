{"remainingRequest":"D:\\共享文件\\code space\\疫情统计分析软件\\22\\epidemicmanagementweb\\node_modules\\babel-loader\\lib\\index.js!D:\\共享文件\\code space\\疫情统计分析软件\\22\\epidemicmanagementweb\\src\\router\\permission.js","dependencies":[{"path":"D:\\共享文件\\code space\\疫情统计分析软件\\22\\epidemicmanagementweb\\src\\router\\permission.js","mtime":1652251439000},{"path":"D:\\共享文件\\code space\\疫情统计分析软件\\22\\epidemicmanagementweb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\共享文件\\code space\\疫情统计分析软件\\22\\epidemicmanagementweb\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiRDovXHU1MTcxXHU0RUFCXHU2NTg3XHU0RUY2L2NvZGUgc3BhY2UvXHU3NUFCXHU2MEM1XHU3RURGXHU4QkExXHU1MjA2XHU2NzkwXHU4RjZGXHU0RUY2LzIyL2VwaWRlbWljbWFuYWdlbWVudHdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJEOi9cdTUxNzFcdTRFQUJcdTY1ODdcdTRFRjYvY29kZSBzcGFjZS9cdTc1QUJcdTYwQzVcdTdFREZcdThCQTFcdTUyMDZcdTY3OTBcdThGNkZcdTRFRjYvMjIvZXBpZGVtaWNtYW5hZ2VtZW50d2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwovLyDot6/nlLHnmoTlhajlsYDlrojljasKLy8g5p2D6ZmQ5o6n5Yi26YC76L6RCmltcG9ydCByb3V0ZXIgZnJvbSAiLi9pbmRleCI7CmltcG9ydCBzdG9yZSBmcm9tICIuLi9zdG9yZS9pbmRleCI7IC8v5byV5YWlbnByb2dyZXNzIOi/m+W6puadoeaPkuS7tgoKaW1wb3J0IE5Qcm9ncmVzcyBmcm9tICJucHJvZ3Jlc3MiOwppbXBvcnQgeyBNZXNzYWdlIH0gZnJvbSAiZWxlbWVudC11aSI7CmltcG9ydCB7IGdldFRva2VuIH0gZnJvbSAiQC91dGlscy9hdXRoIjsgLy8g5LuOY29va2ll6I635Y+W5Luk54mMCi8vIOeugOWNlemFjee9riAg6L+b5bqm5p2hCgpOUHJvZ3Jlc3MuaW5jKDAuMik7Ck5Qcm9ncmVzcy5jb25maWd1cmUoewogIGVhc2luZzogImVhc2UiLAogIHNwZWVkOiA1MDAsCiAgc2hvd1NwaW5uZXI6IGZhbHNlCn0pOwp2YXIgd2hpdGVMaXN0ID0gWyIvbG9naW4iLCAiL3JlZ2lzdGVyIl07IC8v5o6S6Zmk55qE6Lev5b6ECgpyb3V0ZXIuYmVmb3JlRWFjaCggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSh0bywgZnJvbSwgbmV4dCkgewogICAgdmFyIGhhc1Rva2VuLCBoYXNSb2xlcywgX3lpZWxkJHN0b3JlJGRpc3BhdGNoLCByb2xlcywgYWNjZXNzUm91dGVzOwoKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgTlByb2dyZXNzLnN0YXJ0KCk7IC8vIOiOt+WPluS7pOeJjOWIpOaWreeUqOaIt+aYr+WQpueZu+mZhgoKICAgICAgICAgICAgaGFzVG9rZW4gPSBnZXRUb2tlbigpOyAvLyDmnInku6TniYwg6KGo56S65bey57uP55m76ZmGCgogICAgICAgICAgICBpZiAoIWhhc1Rva2VuKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMyOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoISh0by5wYXRoID09PSAiL2xvZ2luIikpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g5bey55m75b2V6YeN5a6a5ZCR5Yiw6aaW6aG1CiAgICAgICAgICAgIG5leHQoewogICAgICAgICAgICAgIHBhdGg6ICIvIgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMwOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIC8v6Iul55So5oi36KeS6Imy5bey6ZmE5Yqg5YiZ6K+05piO5Yqo5oCB6Lev55Sx5bey57uP5re75YqgCiAgICAgICAgICAgIGhhc1JvbGVzID0gc3RvcmUuZ2V0dGVycy5yb2xlcyAmJiBzdG9yZS5nZXR0ZXJzLnJvbGVzLmxlbmd0aCA+IDA7CgogICAgICAgICAgICBpZiAoIWhhc1JvbGVzKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEyOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL+inkuiJsuWtmOWcqAogICAgICAgICAgICBuZXh0KCk7IC8v57un57ut5Y2z5Y+vCgogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzA7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxMjsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE1OwogICAgICAgICAgICByZXR1cm4gc3RvcmUuZGlzcGF0Y2goInVzZXIvZ2V0SW5mbyIpOwoKICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgIF95aWVsZCRzdG9yZSRkaXNwYXRjaCA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgIHJvbGVzID0gX3lpZWxkJHN0b3JlJGRpc3BhdGNoLnJvbGVzOwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTk7CiAgICAgICAgICAgIHJldHVybiBzdG9yZS5kaXNwYXRjaCgicGVybWlzc2lvbi9nZW5lcmF0ZVJvdXRlcyIsIHJvbGVzKTsKCiAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICBhY2Nlc3NSb3V0ZXMgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAvLyDmt7vliqDov5nkupvot6/nlLHoh7Pot6/nlLHlmagKICAgICAgICAgICAgcm91dGVyLmFkZFJvdXRlcyhhY2Nlc3NSb3V0ZXMpOyAvLyDnu6fnu63ot6/nlLHliIfmjaIs56Gu5L+dYWRkUm91dGVz5a6M5oiQCgogICAgICAgICAgICBuZXh0KF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdG8pLCB7fSwgewogICAgICAgICAgICAgIHJlcGxhY2U6IHRydWUKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzA7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAyNDsKICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgxMik7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyODsKICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmRpc3BhdGNoKCJ1c2VyL3Jlc2V0VG9rZW4iKTsKCiAgICAgICAgICBjYXNlIDI4OgogICAgICAgICAgICBNZXNzYWdlLmVycm9yKF9jb250ZXh0LnQwIHx8ICLnvZHnu5zplJnor68iKTsKICAgICAgICAgICAgbmV4dCgiL2xvZ2luP3JlZGlyZWN0PSIuY29uY2F0KHRvLnBhdGgpKTsKCiAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzM7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMzI6CiAgICAgICAgICAgIC8vIOeUqOaIt+aXoOS7pOeJjAogICAgICAgICAgICBpZiAod2hpdGVMaXN0LmluZGV4T2YodG8ucGF0aCkgIT09IC0xKSB7CiAgICAgICAgICAgICAgLy/nmb3lkI3ljZXot6/nlLHmlL7ov4cKICAgICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8g6YeN5a6a5ZCR6Iez55m75b2V6aG1CiAgICAgICAgICAgICAgbmV4dCgiL2xvZ2luP3JlZGlyZWN0PSIuY29uY2F0KHRvLnBhdGgpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgMzM6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZSwgbnVsbCwgW1sxMiwgMjRdXSk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gKF94LCBfeDIsIF94MykgewogICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCkpOwpyb3V0ZXIuYWZ0ZXJFYWNoKGZ1bmN0aW9uICgpIHsKICBOUHJvZ3Jlc3MuZG9uZSgpOwp9KTs="},{"version":3,"sources":["D:/共享文件/code space/疫情统计分析软件/22/epidemicmanagementweb/src/router/permission.js"],"names":["router","store","NProgress","Message","getToken","inc","configure","easing","speed","showSpinner","whiteList","beforeEach","to","from","next","start","hasToken","path","hasRoles","getters","roles","length","dispatch","accessRoutes","addRoutes","replace","error","indexOf","afterEach","done"],"mappings":";;;AAAA;AAEA;AACA,OAAOA,MAAP,MAAmB,SAAnB;AACA,OAAOC,KAAP,MAAkB,gBAAlB,C,CAEA;;AACA,OAAOC,SAAP,MAAsB,WAAtB;AAEA,SAASC,OAAT,QAAwB,YAAxB;AACA,SAASC,QAAT,QAAyB,cAAzB,C,CAAyC;AAEzC;;AACAF,SAAS,CAACG,GAAV,CAAc,GAAd;AACAH,SAAS,CAACI,SAAV,CAAoB;AAAEC,EAAAA,MAAM,EAAE,MAAV;AAAkBC,EAAAA,KAAK,EAAE,GAAzB;AAA8BC,EAAAA,WAAW,EAAE;AAA3C,CAApB;AAEA,IAAMC,SAAS,GAAG,CAAC,QAAD,EAAW,WAAX,CAAlB,C,CAA2C;;AAE3CV,MAAM,CAACW,UAAP;AAAA,qEAAkB,iBAAMC,EAAN,EAAUC,IAAV,EAAgBC,IAAhB;AAAA;;AAAA;AAAA;AAAA;AAAA;AACdZ,YAAAA,SAAS,CAACa,KAAV,GADc,CAEd;;AACMC,YAAAA,QAHQ,GAGGZ,QAAQ,EAHX,EAId;;AAJc,iBAKVY,QALU;AAAA;AAAA;AAAA;;AAAA,kBAMNJ,EAAE,CAACK,IAAH,KAAY,QANN;AAAA;AAAA;AAAA;;AAON;AACAH,YAAAA,IAAI,CAAC;AAAEG,cAAAA,IAAI,EAAE;AAAR,aAAD,CAAJ;AARM;AAAA;;AAAA;AAUN;AACMC,YAAAA,QAXA,GAWWjB,KAAK,CAACkB,OAAN,CAAcC,KAAd,IAAuBnB,KAAK,CAACkB,OAAN,CAAcC,KAAd,CAAoBC,MAApB,GAA6B,CAX/D;;AAAA,iBAaFH,QAbE;AAAA;AAAA;AAAA;;AAcF;AACAJ,YAAAA,IAAI,GAfF,CAeM;;AAfN;AAAA;;AAAA;AAAA;AAAA;AAAA,mBAmB0Bb,KAAK,CAACqB,QAAN,CAAe,cAAf,CAnB1B;;AAAA;AAAA;AAmBUF,YAAAA,KAnBV,yBAmBUA,KAnBV;AAAA;AAAA,mBAsB6BnB,KAAK,CAACqB,QAAN,CACvB,2BADuB,EAEvBF,KAFuB,CAtB7B;;AAAA;AAsBQG,YAAAA,YAtBR;AA2BE;AACAvB,YAAAA,MAAM,CAACwB,SAAP,CAAiBD,YAAjB,EA5BF,CA8BE;;AACAT,YAAAA,IAAI,iCAAKF,EAAL;AAASa,cAAAA,OAAO,EAAE;AAAlB,eAAJ;AA/BF;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,mBAkCQxB,KAAK,CAACqB,QAAN,CAAe,iBAAf,CAlCR;;AAAA;AAmCEnB,YAAAA,OAAO,CAACuB,KAAR,CAAc,eAAS,MAAvB;AACAZ,YAAAA,IAAI,2BAAoBF,EAAE,CAACK,IAAvB,EAAJ;;AApCF;AAAA;AAAA;;AAAA;AAyCV;AACA,gBAAIP,SAAS,CAACiB,OAAV,CAAkBf,EAAE,CAACK,IAArB,MAA+B,CAAC,CAApC,EAAuC;AACnC;AACAH,cAAAA,IAAI;AACP,aAHD,MAGO;AACH;AACAA,cAAAA,IAAI,2BAAoBF,EAAE,CAACK,IAAvB,EAAJ;AACH;;AAhDS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAlB;;AAAA;AAAA;AAAA;AAAA;AAoDAjB,MAAM,CAAC4B,SAAP,CAAiB,YAAM;AACnB1B,EAAAA,SAAS,CAAC2B,IAAV;AACH,CAFD","sourcesContent":["// 路由的全局守卫\n\n// 权限控制逻辑\nimport router from \"./index\";\nimport store from \"../store/index\";\n\n//引入nprogress 进度条插件\nimport NProgress from \"nprogress\";\n\nimport { Message } from \"element-ui\";\nimport { getToken } from \"@/utils/auth\"; // 从cookie获取令牌\n\n// 简单配置  进度条\nNProgress.inc(0.2);\nNProgress.configure({ easing: \"ease\", speed: 500, showSpinner: false });\n\nconst whiteList = [\"/login\", \"/register\"]; //排除的路径\n\nrouter.beforeEach(async(to, from, next) => {\n    NProgress.start();\n    // 获取令牌判断用户是否登陆\n    const hasToken = getToken();\n    // 有令牌 表示已经登陆\n    if (hasToken) {\n        if (to.path === \"/login\") {\n            // 已登录重定向到首页\n            next({ path: \"/\" });\n        } else {\n            //若用户角色已附加则说明动态路由已经添加\n            const hasRoles = store.getters.roles && store.getters.roles.length > 0;\n\n            if (hasRoles) {\n                //角色存在\n                next(); //继续即可\n            } else {\n                try {\n                    //先请求获取用户角色\n                    const { roles } = await store.dispatch(\"user/getInfo\");\n\n                    // 根据当前用户角色动态生成路由\n                    const accessRoutes = await store.dispatch(\n                        \"permission/generateRoutes\",\n                        roles\n                    );\n\n                    // 添加这些路由至路由器\n                    router.addRoutes(accessRoutes);\n\n                    // 继续路由切换,确保addRoutes完成\n                    next({...to, replace: true });\n                } catch (error) {\n                    // 出错需要重置令牌并重新登陆(令牌过期,网络错误等原因)\n                    await store.dispatch(\"user/resetToken\");\n                    Message.error(error || \"网络错误\");\n                    next(`/login?redirect=${to.path}`);\n                }\n            }\n        }\n    } else {\n        // 用户无令牌\n        if (whiteList.indexOf(to.path) !== -1) {\n            //白名单路由放过\n            next();\n        } else {\n            // 重定向至登录页\n            next(`/login?redirect=${to.path}`);\n        }\n    }\n});\n\nrouter.afterEach(() => {\n    NProgress.done();\n});"]}]}